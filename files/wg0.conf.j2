{% for h in wireguard_hosts %}
{% if h.name == wireguard_name %}
[Interface]
# Interface: {{ h.name }}
PrivateKey = {{ h.keypair.private }}
# Hardcode /30 subnet for two hosts
# Trying /24 in case that helps?
Address = {{ h.address }}/24
#DNS = 1.1.1.1, 1.0.0.1
{% if h.listenport %}
ListenPort = {{ h.listenport }}
{% endif %}
{% endif %}
{% endfor %}

{% for h in wireguard_hosts %}
{% if h.name != wireguard_name %}
[Peer]
# Peer: {{ h.name }}
PublicKey = {{ h.keypair.public }}
{% if h.endpoint %}
Endpoint = {{ h.endpoint }}:{{ h.listenport }}
{% endif %}
PersistentKeepalive = 25
AllowedIPs = {{ h.address }}/32
{% endif %}
{% endfor %}
